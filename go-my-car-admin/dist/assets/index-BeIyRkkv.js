import{O as R,b as k,e as $,t as A,o as O,r as l,H as V,z as M,j as e,B as d,I as _,J as h,K as z,M as j,T as G}from"./index-CiOuKirm.js";import{F as H,a as J,b as K,c as q,d as Q,e as X,f as Y}from"./form-D9IExxpP.js";import{S as Z,P as W,T as ee}from"./switch-DQHW1aF0.js";import{o as se}from"./helper-CbO53uKL.js";import{d as ae,e as te}from"./index-DYJYlM-b.js";const re=O({isSelected:z().default(!1),images:h(j()),carImage:h(j())}).strict(),me=()=>{const{id:m}=R();console.log("id",m);const p=k(),{data:c,isLoading:b,isError:v,error:S,refetch:y}=ae(m),I=s=>{G("success",(s==null?void 0:s.message)||"banner Updated Successfully"),p("/banner")},{mutate:N,isPending:u}=te(I),r=$({resolver:A(re),defaultValues:{isSelected:!1,images:[],carImage:[]}}),{control:w,register:F}=r,[f,g]=l.useState({}),{fields:C,append:U,remove:B}=V({control:w,name:"images"}),[ne,E]=l.useState({});l.useEffect(()=>{var a;const s=c==null?void 0:c.data;if(s){E(s);const n={};(a=s.carImage)==null||a.forEach((o,t)=>{n[t]=typeof o=="string"?`${M}/static/${o}`:URL.createObjectURL(o)}),g(n),r.reset({isSelected:s.isSelected,images:s.carImage||[],carImage:s.carImage||[]})}},[c,r.reset,y]);const[x,L]=l.useState([]);function T(s){console.log("data",s);const a=new FormData;a.append("isSelected",s.isSelected),x.length>0&&a.append("imageToRemove",x.join(",")),s.images&&s.images.forEach((n,o)=>{const t=n instanceof FileList?n[0]:n;t instanceof File&&a.append("images",t)}),N({id:m,data:a})}return b?e.jsx("div",{children:"Loading banner details..."}):v?e.jsx("div",{className:"text-danger font-semibold",children:S.message}):e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Update Banner"}),e.jsx(H,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(T,se),className:"space-y-8 w-full max-w-5xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(J,{control:r.control,name:"isSelected",render:({field:s})=>e.jsxs(K,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(q,{className:"text-base",children:"isSelected"}),e.jsx(Q,{children:"Toggle to activate or deactivate the isSelected"})]}),e.jsx(X,{children:e.jsx(Z,{checked:s.value,onCheckedChange:a=>s.onChange(a)})})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("label",{className:"block font-medium",children:"Upload Images"}),e.jsxs(d,{type:"button",variant:"secondary",onClick:()=>U(null),className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Add Image"]}),e.jsx(Y,{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:C.map((s,a)=>{var n;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(_,{type:"file",accept:"image/*",...F(`images.${a}`),onChange:o=>{var i;const t=(i=o.target.files)==null?void 0:i[0];if(t){const P=URL.createObjectURL(t);g(D=>({...D,[a]:P}))}}}),f[a]&&e.jsx("img",{src:f[a],alt:`Preview ${a}`,className:"w-32 h-32 object-cover border rounded"}),typeof((n=r.formState.errors.image)==null?void 0:n.message)=="string"&&e.jsx("p",{className:"text-red-500 text-sm",children:r.formState.errors.image.message}),e.jsx(d,{type:"button",variant:"ghost",onClick:()=>{const o=r.getValues(`images.${a}`);typeof o=="string"&&L(t=>[...t,o]),B(a),g(t=>{const i={...t};return delete i[a],i})},className:"px-2 w-fit text-red-600",children:e.jsx(ee,{className:"h-4 w-4"})})]},s.id)})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>p("/banner"),children:"Cancel"}),e.jsx(d,{type:"submit",disabled:u,children:u?"Updating...":"Update Banner"})]})]})})]})};export{me as default};
