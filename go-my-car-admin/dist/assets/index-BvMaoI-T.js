import{O as te,b as ce,e as ne,t as ie,o as le,r as b,H as A,z as oe,j as e,I as d,Q as de,V as me,B as u,J as N,K as C,s as p,W as S,M as P,T as he}from"./index-CiOuKirm.js";import{F as xe,a as t,b as c,c as n,e as i,d as m,f as o}from"./form-D9IExxpP.js";import{S as q,P as U,T as F}from"./switch-DQHW1aF0.js";import{S as M,a as G,b as R,c as k,d as _}from"./select-BkN_i5Bb.js";import{o as je}from"./helper-CbO53uKL.js";import{c as pe,d as ue}from"./index-BlcXzX0V.js";const ge=le({carName:p({required_error:"carName is required"}).min(1,"carName cannot be empty").max(50,"carName must be 50 characters or less").toUpperCase().trim(),carModal:S({required_error:"carModal Value is required"}).min(4,"carModal min 4 number"),carGear:p({required_error:"carGear is required"}),carType:p({required_error:"carType is required"}),carSheet:S({required_error:"carSheet Value is required"}).min(1,"carSheet cannot be empty"),carPrice:S({required_error:"carPrice Value is required"}).min(1,"carPrice cannot be empty"),startDate:p({required_error:"Start Date is required"}).transform(h=>new Date(h)),endDate:p({required_error:"End Date is required"}).refine(h=>!isNaN(Date.parse(h)),{message:"Invalid End Date format"}).transform(h=>new Date(h)),fastag:C().default(!1),isAvailable:C().default(!0),location:p().min(1,"Location is required"),hostName:p().min(1,"Host name is required"),isActive:C().optional(),feature:N(p().min(1,"Each feature must not be empty")).min(1,"At least one feature is required"),images:N(P()),carImage:N(P())}).strict(),De=()=>{var I;const{id:h}=te();console.log("id",h);const y=ce(),{data:g,isLoading:L,isError:V,error:O}=pe(h),$=a=>{he("success",(a==null?void 0:a.message)||"Car Updated Successfully"),y("/car")},{mutate:B,isPending:D}=ue($),H=()=>{s.reset({carName:"",carModal:void 0,carGear:"",carType:"",carSheet:void 0,carPrice:void 0,fastag:!1,isAvailable:!1,startDate:"",endDate:"",location:"",hostName:"",isActive:!0,feature:[],images:[]}),v({})},s=ne({resolver:ie(ge),defaultValues:{carName:"",carModal:void 0,carGear:void 0,carType:void 0,carSheet:void 0,carPrice:void 0,fastag:!1,isAvailable:!1,startDate:new Date().toISOString().split("T")[0],endDate:"",location:"",hostName:"",isActive:!0,feature:[],images:[],carImage:[]}}),{control:z,register:w}=s,[T,v]=b.useState({}),{fields:J,append:K,remove:Q}=A({control:s.control,name:"feature"}),{fields:Y,append:X,remove:Z}=A({control:z,name:"images"}),[fe,W]=b.useState({});console.log("carDataResponse",g),b.useEffect(()=>{var r;const a=g==null?void 0:g.data;if(a){W(a);const x={};(r=a.carImage)==null||r.forEach((j,l)=>{x[l]=typeof j=="string"?`${oe}/static/${j}`:URL.createObjectURL(j)}),v(x),s.reset({carName:a.carName||"",carModal:a.carModal||"",carGear:a.carGear||"",carType:a.carType||"",carSheet:Number(a.carSheet)||"",carPrice:a.carPrice||"",fastag:a.fastag,isAvailable:a.isAvailable,hostName:a.hostName||"",startDate:a.startDate?new Date(a.startDate).toISOString().split("T")[0]:"",endDate:a.endDate?new Date(a.endDate).toISOString().split("T")[0]:"",location:a.location||"",feature:a.feature||[],images:a.carImage||[],carImage:a.carImage||[]})}},[g,s.reset]);const[E,ee]=b.useState([]);function ae(a){console.log("data",a);const r=new FormData;r.append("carName",a.carName),r.append("carModal",a.carModal),r.append("carGear",a.carGear),r.append("carType",a.carType),r.append("carSheet",a.carSheet),r.append("carPrice",a.carPrice),r.append("fastag",a.fastag),r.append("isAvailable",a.isAvailable),r.append("hostName",a.hostName),r.append("startDate",new Date(a.startDate).toISOString()),r.append("endDate",new Date(a.endDate).toISOString()),r.append("location",a.location),r.append("feature",a.feature),E.length>0&&r.append("imageToRemove",E.join(",")),a.images&&a.images.forEach((x,j)=>{const l=x instanceof FileList?x[0]:x;l instanceof File&&r.append("images",l)}),B({id:h,data:r})}return L?e.jsx("div",{children:"Loading car details..."}):V?e.jsx("div",{className:"text-danger font-semibold",children:O.message}):e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Update Car"}),e.jsx(xe,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(ae,je),className:"space-y-8 w-full max-w-5xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(t,{control:s.control,name:"carName",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"Car Name"}),e.jsx(i,{children:e.jsx(d,{placeholder:"Enter Car Name",...a})}),e.jsx(m,{children:"Unique name for the car (max 50 characters)"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"carModal",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"car Modal"}),e.jsx(i,{children:e.jsx(d,{type:"number",placeholder:"Enter Car Modal",...a,onChange:r=>a.onChange(Number(r.target.value))})}),e.jsx(m,{children:"Enter car modal"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"carGear",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"carGear"}),e.jsxs(M,{onValueChange:a.onChange,value:a.value,children:[e.jsx(i,{children:e.jsx(G,{children:e.jsx(R,{placeholder:"Select Car Gear"})})}),e.jsx(k,{children:Object.values(de).map(r=>e.jsx(_,{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsx(m,{children:"Select car gear"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"carType",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"carType"}),e.jsxs(M,{onValueChange:a.onChange,value:a.value,children:[e.jsx(i,{children:e.jsx(G,{children:e.jsx(R,{placeholder:"Select Car Type"})})}),e.jsx(k,{children:Object.values(me).map(r=>e.jsx(_,{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsx(m,{children:"Select car type"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"carSheet",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"car Sheet"}),e.jsx(i,{children:e.jsx(d,{type:"number",placeholder:"Enter car Sheet",...a,onChange:r=>a.onChange(Number(r.target.value))})}),e.jsx(m,{children:"Enter car sheet"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"carPrice",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"car Price (hr)"}),e.jsx(i,{children:e.jsx(d,{type:"number",placeholder:"Enter car Price",...a,onChange:r=>a.onChange(Number(r.target.value))})}),e.jsx(m,{children:"Enter car price"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"fastag",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(n,{className:"text-base",children:"fastag"}),e.jsx(m,{children:"Toggle to activate or deactivate the fastag"})]}),e.jsx(i,{children:e.jsx(q,{checked:a.value,onCheckedChange:r=>a.onChange(r)})})]})}),e.jsx(t,{control:s.control,name:"isAvailable",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(n,{className:"text-base",children:"isAvailable"}),e.jsx(m,{children:"Toggle to activate or deactivate the car"})]}),e.jsx(i,{children:e.jsx(q,{checked:a.value,onCheckedChange:r=>a.onChange(r)})})]})}),e.jsx(t,{control:s.control,name:"startDate",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"Start Date"}),e.jsx(i,{children:e.jsx(d,{type:"date",...a})}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"endDate",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"End Date"}),e.jsx(i,{children:e.jsx(d,{type:"date",...a})}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"location",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"location"}),e.jsx(i,{children:e.jsx(d,{placeholder:"Enter location",...a})}),e.jsx(m,{children:"Choose car location"}),e.jsx(o,{})]})}),e.jsx(t,{control:s.control,name:"hostName",render:({field:a})=>e.jsxs(c,{children:[e.jsx(n,{children:"hostName"}),e.jsx(i,{children:e.jsx(d,{placeholder:"Enter hostName",...a})}),e.jsx(m,{children:"Choose hostName"}),e.jsx(o,{})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("label",{className:"block",children:"feature"}),e.jsxs(u,{type:"button",variant:"secondary",onClick:()=>K(""),className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Add feature"]})]}),typeof((I=s.formState.errors.feature)==null?void 0:I.message)=="string"&&e.jsx("p",{className:"text-red-500 text-sm",children:s.formState.errors.feature.message}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:J.map((a,r)=>e.jsxs("div",{className:"flex gap-2 flex-col",children:[e.jsx(d,{...w(`feature.${r}`),placeholder:`Feature ${r+1}`}),e.jsx(u,{type:"button",variant:"ghost",onClick:()=>Q(r),className:"px-2 w-fit text-red-600",children:e.jsx(F,{className:"h-4 w-4"})})]},a.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("label",{className:"block font-medium",children:"Upload Images"}),e.jsxs(u,{type:"button",variant:"secondary",onClick:()=>X(null),className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Add Image"]}),e.jsx(o,{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Y.map((a,r)=>{var x;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",...w(`images.${r}`),onChange:j=>{var f;const l=(f=j.target.files)==null?void 0:f[0];if(l){const re=URL.createObjectURL(l);v(se=>({...se,[r]:re}))}}}),T[r]&&e.jsx("img",{src:T[r],alt:`Preview ${r}`,className:"w-32 h-32 object-cover border rounded"}),typeof((x=s.formState.errors.image)==null?void 0:x.message)=="string"&&e.jsx("p",{className:"text-red-500 text-sm",children:s.formState.errors.image.message}),e.jsx(u,{type:"button",variant:"ghost",onClick:()=>{const j=s.getValues(`images.${r}`);typeof j=="string"&&ee(l=>[...l,j]),Z(r),v(l=>{const f={...l};return delete f[r],f})},className:"px-2 w-fit text-red-600",children:e.jsx(F,{className:"h-4 w-4"})})]},a.id)})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>y("/car"),children:"Cancel"}),e.jsx(u,{onClick:H,variant:"secondary",children:"Reset Car"}),e.jsx(u,{type:"submit",disabled:D,children:D?"Updating...":"Update Car"})]})]})})]})};export{De as default};
